PACKAGE = "fuims"

from dynamic_reconfigure.parameter_generator_catkin import *

gen = ParameterGenerator()

# =========================================================
# General VIO Parameters
# =========================================================
gen.add(
    "MAX_FEATURES", int_t, 0,
    "Maximum number of features for tracking",
    250, 100, 1500
)

gen.add(
    "MIN_FEATURES", int_t, 0,
    "Minimum number of features for tracking",
    25, 10, 1200
)

gen.add(
    "MIN_TRACKED_FEATURES", int_t, 0,
    "Minimum number of tracked features before relocalization",
    35, 5, 500
)

gen.add(
    "MAX_TRACKING_ERROR_PX", double_t, 0,
    "Maximum allowable tracking error in pixels",
    7.5, 0.1, 35.0
)

gen.add(
    "MAX_TRACKING_AGE", int_t, 0,
    "Maximum number of frames a feature can be tracked",
    5, 1, 25
)

gen.add(
    "KF_FEATURE_THRESHOLD", int_t, 0,
    "Minimum number of features to accept a keyframe",
    75, 10, 500
)

gen.add(
    "KF_PARALLAX_THRESHOLD", int_t, 0,
    "Parallax threshold (pixels) for keyframe creation",
    28, 5, 150
)

gen.add(
    "GPS_PRIOR_INTERVAL", int_t, 0,
    "Insert GPS prior every N keyframes",
    10, 1, 100
)

gen.add(
    "GPS_PRIOR_ENABLE", bool_t, 0,
    "Enable GPS prior factor in optimization",
    True
)

# =========================================================
# GFTT Parameters (Good Features To Track)
# =========================================================
gen.add(
    "GFTT_MAX_FEATURES", int_t, 0,
    "Maximum number of GFTT features to detect",
    500, 50, 3000
)

gen.add(
    "GFTT_BLOCK_SIZE", int_t, 0,
    "Block size used by GFTT",
    3, 1, 15
)

gen.add(
    "GFTT_QUALITY", double_t, 0,
    "Quality level for GFTT feature detection",
    0.15, 0.001, 0.5
)

gen.add(
    "GFTT_MIN_DIST", double_t, 0,
    "Minimum distance between detected features (pixels)",
    26.0, 1.0, 100.0
)

# =========================================================
# KLT Parameters (Lucasâ€“Kanade Optical Flow)
# =========================================================
gen.add(
    "KLT_MAX_LEVEL", int_t, 0,
    "Number of pyramid levels for KLT",
    4, 0, 8
)

gen.add(
    "KLT_ITERS", int_t, 0,
    "Maximum number of KLT iterations",
    30, 5, 100
)

gen.add(
    "KLT_BORDER_MARGIN", int_t, 0,
    "Pixel margin to avoid tracking near image borders",
    10, 0, 50
)

gen.add(
    "KLT_EPS", double_t, 0,
    "Convergence epsilon for KLT",
    0.01, 1e-6, 0.1
)

gen.add(
    "KLT_MIN_EIG", double_t, 0,
    "Minimum eigenvalue threshold for KLT tracking",
    1e-4, 1e-6, 1e-2
)

gen.add(
    "KLT_FB_THRESH_PX", double_t, 0,
    "Forward-backward consistency threshold (pixels)",
    1.0, 0.1, 5.0
)

# =========================================================
# Information Rate
# =========================================================
gen.add(
    "CAMERA_RATE", int_t, 0,
    "Camera messages rate (Hz)",
    15, 1, 30
)


gen.add(
    "INERTIAL_RATE", int_t, 0,
    "Inercial messages rate (Hz)",
    30, 1, 50
)

# =========================================================
# Visual Odometry Noise Parameters (per-axis)
# =========================================================
gen.add(
    "VO_NOISE_ROT_X", double_t, 0,
    "VO: Rotation noise around X axis - Roll (rad)",
    0.2, 0.001, 5.0
)

gen.add(
    "VO_NOISE_ROT_Y", double_t, 0,
    "VO: Rotation noise around Y axis - Pitch (rad)",
    0.2, 0.001, 5.0
)

gen.add(
    "VO_NOISE_ROT_Z", double_t, 0,
    "VO: Rotation noise around Z axis - Yaw (rad)",
    0.2, 0.001, 5.0
)

gen.add(
    "VO_NOISE_TRANS_X", double_t, 0,
    "VO: Translation noise along X axis - East (m)",
    0.5, 0.001, 10.0
)

gen.add(
    "VO_NOISE_TRANS_Y", double_t, 0,
    "VO: Translation noise along Y axis - North (m)",
    0.5, 0.001, 10.0
)

gen.add(
    "VO_NOISE_TRANS_Z", double_t, 0,
    "VO: Translation noise along Z axis - Up (m)",
    0.5, 0.001, 10.0
)

# =========================================================
# Inertial Prior Noise Parameters (per-axis)
# =========================================================
gen.add(
    "ROT_PRIOR_NOISE_X", double_t, 0,
    "Rotation prior noise around X axis - Roll (rad)",
    0.05, 0.001, 5.0
)

gen.add(
    "ROT_PRIOR_NOISE_Y", double_t, 0,
    "Rotation prior noise around Y axis - Pitch (rad)",
    0.05, 0.001, 5.0
)

gen.add(
    "ROT_PRIOR_NOISE_Z", double_t, 0,
    "Rotation prior noise around Z axis - Yaw (rad)",
    0.05, 0.001, 5.0
)

gen.add(
    "TRANS_PRIOR_NOISE_X", double_t, 0,
    "Translation prior noise along X axis - East (m)",
    0.1, 0.001, 10.0
)

gen.add(
    "TRANS_PRIOR_NOISE_Y", double_t, 0,
    "Translation prior noise along Y axis - North (m)",
    0.1, 0.001, 10.0
)

gen.add(
    "TRANS_PRIOR_NOISE_Z", double_t, 0,
    "Translation prior noise along Z axis - Up (m)",
    0.1, 0.001, 10.0
)

# =========================================================
# GPS Noise Parameters (per-axis)
# =========================================================
gen.add(
    "GPS_NOISE_X", double_t, 0,
    "GPS prior noise along X axis - East (m)",
    1.0, 0.0001, 50.0
)

gen.add(
    "GPS_NOISE_Y", double_t, 0,
    "GPS prior noise along Y axis - North (m)",
    1.0, 0.0001, 50.0
)

gen.add(
    "GPS_NOISE_Z", double_t, 0,
    "GPS prior noise along Z axis - Up (m)",
    1.0, 0.0001, 50.0
)

# =========================================================
# Altitude Prior Noise
# =========================================================
gen.add(
    "ALT_PRIOR_NOISE", double_t, 0,
    "Altitude prior noise (m) - constrains Z independently",
    0.5, 0.01, 50.0
)

# =========================================================
# Generate config
# =========================================================
exit(gen.generate(PACKAGE, "fuims", "vioParams"))
